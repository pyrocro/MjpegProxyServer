# This file is a template, and might need editing before it works on your project.
# Official docker image.
image: docker:latest

services:
  - docker:dind

build:
  stage: build
  script:
    - echo %CI_PROJECT_NAME%
    - echo %CI_REGISTRY_IMAGE%
    - echo :%IMAGE_TAG%
    - echo %CI_COMMIT_REF_NAME%
    - echo %CI_COMMIT_TAG%
    - set IMAGE_TAG=latest #%(echo -en %CI_COMMIT_REF_NAME% | tr -c '[:alnum:]_.-' '-')%
    - docker login -u "gitlab-ci-token" -p "%CI_JOB_TOKEN%" %CI_REGISTRY%
    - echo "%CI_REGISTRY_IMAGE%:%IMAGE_TAG%"
    - docker build --pull -t "%CI_REGISTRY_IMAGE%:%IMAGE_TAG%" .
    - docker push "%CI_REGISTRY_IMAGE%:%IMAGE_TAG%"
